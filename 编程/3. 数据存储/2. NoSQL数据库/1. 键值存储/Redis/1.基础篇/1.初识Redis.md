
Redis是一种键值型的NoSql数据库，这里有两个关键字：

键值型——键值对 key-value


NoSql

其中键值型，是指Redis中存储的数据都是以key、value对的形式存储，而value的形式多种多样，可以是字符串、数值、甚至json：


![img|775](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/c0a242773cc04e4bb2934b200d4929dd.png)

而**NoSql则是相对于传统关系型数据库而言，有很大差异的一种数据库**。



# 1. 认识NoSQL
NoSql可以翻译做Not Only Sql（不仅仅是SQL），或者是No Sql（非Sql的）数据库。是相对于传统关系型数据库而言，有很大差异的一种特殊的数据库，因此也称之为非关系型数据库。

SQL：关系型数据库

Structured：结构化

### 1.1 结构化与非结构化
传统关系型数据库是结构化数据，每一张表都有严格的约束信息：字段名、字段数据类型、字段约束等等信息，插入的数据必须遵守这些约束：

结构化，一般不对表的结构进行修改![img](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/89842b8ccfd44b578aef37f95815c4c2.png)

而**NoSql则对数据库格式没有严格约束**，往往形式松散，自由。

- **非结构化**

可以是键值型：

![img](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/b534ec6f422a4b38a133510fafe562a7.png)

也可以是文档型：以JSON的格式进行存储

![img](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/e19d84efe19643249d193145ac5a1edb.png)

甚至可以是图格式：

![img](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/14ddebe903cd42a1b1eacd5ad6507a08.png)

### 1.2. 关联和非关联

传统数据库的表与表之间往往存在关联，例如外键：

- order订单表将user和item关联起来，**表与表之间有关系**
- 关联的

![img](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/ec70a5d7982749c78c94df06f1b46333.png)

而**非关系型数据库不存在关联关系**，要维护关系要么靠代码中的业务逻辑，要么靠数据之间的耦合（嵌套）：

无关联的

{
  id: 1,
  name: "张三",
  orders: [
    {
       id: 1,
       item: {
	 id: 10, title: "荣耀6", price: 4999
       }
    },
    {
       id: 2,
       item: {
	 id: 20, title: "小米11", price: 3999
       }
    }
  ]
}
此处要维护“张三”的订单与商品“荣耀”和“小米11”的关系，不得不冗余的将这两个商品保存在张三的订单文档中，不够优雅。还是建议用业务来维护关联关系。

### 1.3. 查询方式
传统关系型数据库会基于Sql语句做查询，语法有统一标准；

而不同的非关系数据库查询语法差异极大，五花八门各种各样。![img](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/bc79f8f0f60c4c96baca402655165078.png)

### 1.4. 事务

**传统关系型数据库能满足事务ACID的原则。**

> ACID 原则
> A - 原子性 (Atomicity)
>
> 事务中的所有操作要么全部成功，要么全部失败。即使在事务的执行过程中出现问题，已执行的操作也会被回滚，不会有部分操作成功，部分操作失败的情况。
> 举例：银行转账操作，转出和转入必须一起成功，否则都不成功。
> C - 一致性 (Consistency)
>
> 事务执行前后，数据库的状态必须是一致的。也就是说，事务必须使数据库从一个一致的状态转变到另一个一致的状态。
> 举例：如果你有一个“账户”表和一个“余额”字段，执行转账操作前后，账户的余额必须符合预定规则，不能出现负数余额（除非允许透支）。
> I - 隔离性 (Isolation)
>
> 并发执行的事务之间是隔离的，一个事务的执行不应该受到其他事务的干扰。不同的隔离级别定义了事务如何相互隔离。
> 举例：如果两个用户同时向同一个账户转账，系统必须确保每个用户的操作不会互相干扰，最终结果是正确的。
> D - 持久性 (Durability)
>
> 一旦事务被提交，它对数据库的修改就是永久性的，即使发生系统崩溃，也能够恢复事务的结果。
> 举例：如果你成功提交了一个转账事务，即使在提交后发生了系统崩溃，数据库也应该能够在重启后恢复该事务的结果。



而非关系型数据库往往不支持事务，或者不能严格保证ACID的特性，只能实现基本的一致性。BASE

### 1.5. 总结

除了上述四点以外，在存储方式、扩展性、查询性能上关系型与非关系型也都有着显著差异，总结如下：

存储方式

关系型数据库基于磁盘进行存储，会有大量的磁盘IO，对性能有一定影响

非关系型数据库，他们的操作更多的是依赖于内存来操作，内存的读写速度会非常快，性能自然会好一些

扩展性

关系型数据库集群模式一般是主从，主从数据一致，起到数据备份的作用，称为垂直扩展。

非关系型数据库可以将数据拆分，存储在不同机器上，可以保存海量数据，解决内存大小有限的问题。称为水平扩展。

关系型数据库因为表之间存在关联关系，如果做水平扩展会给数据查询带来很多麻烦

# 2. 认识Redis

Redis诞生于2009年全称是Remote Dictionary Server 远程词典服务器，是一个基于内存的键值型NoSQL数据库。

特征：

键值（key-value）型，value支持多种不同数据结构，功能丰富

单线程，每个命令具备原子性——所有线程串行执行，线程是安全的，不会存在一个命令执行到一半，有其他命令插入进来的情况

低延迟，速度快（基于内存、IO多路复用（提高了吞吐量）、良好的编码）——内存和磁盘的读写速度差异太大了

支持数据持久化——定时将内存上的数据保存到磁盘中

支持主从集群（MySQL）、分片集群（水平扩展）

支持多语言客户端（任何语言都能用）


```
用户请求层
─────────────────────────────────────────────
    👤        👤        👤        👤
  用户1      用户2      用户3      用户4
    │         │         │         │
    └─────────┴─────────┴─────────┘
              │
         负载均衡器
              │
    ┌─────────┼─────────┐
    │         │         │
    ↓         ↓         ↓
┌────────┐┌────────┐┌────────┐  ← Web服务器集群
│服务器 A││服务器 B││服务器 C│     (运行Java应用)
│        ││        ││        │
│ Redis  ││ Redis  ││ Redis  │  ← Redis客户端
│ Client ││ Client ││ Client │     (Jedis/Lettuce)
└───┬────┘└───┬────┘└───┬────┘
    │         │         │
    └─────────┼─────────┘
              │ TCP/IP 连接 (默认端口 6379)
              ↓
    ┌──────────────────┐          ← Redis服务器
    │   Redis Server   │             (独立的服务器)
    │   IP: 10.0.0.10  │
    │   端口: 6379      │
    └──────────────────┘
              │
    存储在内存中的数据
    ┌──────────────────┐
    │ user:1 = "张三"  │
    │ stock:100 = 50   │
    │ lock:order = "1" │
    └──────────────────┘

```