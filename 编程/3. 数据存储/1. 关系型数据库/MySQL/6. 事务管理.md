
# 一. 事务基础

## 1. 事务概念

数据库的事务是一种机制，包含了一组数据库操作命令。事务把所有的命令作为一个整体一起向系统提交或撤销操作请求，即这一组数据库命令要么同时成功，要么同时失败。

例如在进行转账操作时，张三转账给李四 500 元，首先会验证张三账户余额是否充足，如果是，则张三账户减少 500，李四账户增加 500 。如果在这过程中，由于某种原因出现错误，李四的账户没有增加 500 ，那么张三账户减少 500 的操作也不能完成。也就是要保证在这个过程中张三和李四账户余额总和要保持不变。

![image.png|500](https://picgo-q1uill.oss-cn-chengdu.aliyuncs.com/img-for-typora/20250421174810837.png)


## 2. 事务操作语法

开启事务：

```sql
START TRANSACTION;
或者
BEGIN;
```

回滚事务：

```sql
commit;
```

提交事务：

```sql
rollback;
```

小练习：张三转账给李四

```sql
DROP TABLE IF EXISTS account;
-- 创建账户表
CREATE TABLE account(
	id int PRIMARY KEY auto_increment,
	name varchar(10),
	money double(10,2)
);
-- 添加数据
INSERT INTO account(name,money) values('张三',1000),('李四',1000);
```

添加事务：

```sql
-- 开启事务
BEGIN;
-- 转账操作
-- 1. 查询李四账户金额是否大于500
-- 2. 张三账户 -500
UPDATE account set money = money - 500 where name = '张三';
3%0;--出现异常
-- 3. 李四账户 +500
UPDATE account set money = money + 500 where name = '李四';
-- 提交事务
COMMIT;
-- 回滚事务
ROLLBACK;
```

如果不添加事务，张三的账户就会减少 500 ，而李四的账户并不会增加 500，这样并不符合我们的实际生活。否则张三的 500 便不翼而飞了，哈哈哈！可见事务的重要性。


## 3. 事务特性

MySQl 事务具有四大特征，分别是：

- 原子性: 事务是不可分割的最小操作单位，要么同时成功，要么同时失败
- 一致性 :事务完成时，必须使所有的数据都保持一致状态
- 隔离性: 多个事务之间，操作的可见性
- 持久性: 事务一旦提交或回滚，它对数据库中的数据的改变就是永久的