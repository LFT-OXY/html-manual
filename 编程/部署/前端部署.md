# ğŸ¨ Vueå‰ç«¯å®Œæ•´éƒ¨ç½²æ•™ç¨‹

## ğŸ“‹ å‰ææ¡ä»¶

- âœ… åç«¯å·²éƒ¨ç½²æˆåŠŸï¼ˆè¿è¡Œåœ¨ 8080 ç«¯å£ï¼‰
- âœ… æœåŠ¡å™¨å·²å®‰è£… Nginx
- âœ… æœ¬åœ°å·²å®‰è£… Node.js å’Œ npm

---

## ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°ä¿®æ”¹å‰ç«¯é…ç½® ğŸ”§

### 1.1 ç¡®è®¤å‰ç«¯ç›®å½•

```bash
# åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•
cd /Users/oxy/Documents/program/CompanyProjects/zhuanxiangzhai-master/RuoYi-Vue-master

# è¿›å…¥å‰ç«¯ç›®å½•ï¼ˆæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ï¼‰
cd ruoyi-ui2
# æˆ–
cd ruo-ui-1
```

### 1.2 ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®

æ‰“å¼€æ–‡ä»¶ï¼š`.env.production`

```bash
# åœ¨å‰ç«¯ç›®å½•ä¸‹
vim .env.production
```

**ä¿®æ”¹ä¸ºï¼š**
```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
ENV = 'production'

# è‹¥ä¾ç®¡ç†ç³»ç»Ÿ/ç”Ÿäº§ç¯å¢ƒ
VUE_APP_BASE_API = '/prod-api'

# æ³¨é‡Šï¼š
# è¿™é‡Œé…ç½®æˆ /prod-apiï¼Œåé¢ä¼šé€šè¿‡ Nginx åå‘ä»£ç†åˆ°åç«¯çš„ 8080 ç«¯å£
```

**ä¿å­˜é€€å‡º** ï¼ˆæŒ‰ `Esc`ï¼Œç„¶åè¾“å…¥ `:wq`ï¼‰

### 1.3 æ£€æŸ¥å…¶ä»–å¯èƒ½éœ€è¦ä¿®æ”¹çš„é…ç½®

æ‰“å¼€ `vue.config.js`ï¼š

```bash
vim vue.config.js
```

ç¡®ä¿æœ‰ä»¥ä¸‹é…ç½®ï¼š
```javascript
module.exports = {
  publicPath: '/',  // éƒ¨ç½²åº”ç”¨åŒ…æ—¶çš„åŸºæœ¬ URL
  outputDir: 'dist',  // æ‰“åŒ…è¾“å‡ºç›®å½•
  assetsDir: 'static',  // é™æ€èµ„æºç›®å½•
  lintOnSave: false,  // æ˜¯å¦åœ¨ä¿å­˜æ—¶è¿›è¡Œeslintæ£€æŸ¥
  productionSourceMap: false,  // ç”Ÿäº§ç¯å¢ƒä¸ç”Ÿæˆ source map
  
  devServer: {
    port: 8080,
    open: true,
    proxy: {
      // å¼€å‘ç¯å¢ƒä»£ç†é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒä¸ä½¿ç”¨ï¼‰
      [process.env.VUE_APP_BASE_API]: {
        target: `http://localhost:8080`,
        changeOrigin: true,
        pathRewrite: {
          ['^' + process.env.VUE_APP_BASE_API]: ''
        }
      }
    }
  }
}
```

---

## ç¬¬äºŒæ­¥ï¼šæœ¬åœ°å®‰è£…ä¾èµ–å’Œæ‰“åŒ… ğŸ“¦

### 2.1 å®‰è£…ä¾èµ–

```bash
# ç¡®ä¿åœ¨å‰ç«¯ç›®å½•ä¸‹ï¼ˆruoyi-ui2 æˆ– ruo-ui-1ï¼‰
pwd  # ç¡®è®¤å½“å‰è·¯å¾„

# å®‰è£…ä¾èµ–ï¼ˆç¬¬ä¸€æ¬¡éƒ¨ç½²éœ€è¦æ‰§è¡Œï¼‰
npm install

# å¦‚æœ npm install å¾ˆæ…¢ï¼Œå¯ä»¥ä½¿ç”¨æ·˜å®é•œåƒ
npm install --registry=https://registry.npmmirror.com
```

**æ³¨æ„ï¼š** è¿™ä¸€æ­¥å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

### 2.2 æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ

```bash
# æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ
npm run build:prod

# æ‰“åŒ…è¿‡ç¨‹ä¼šæ˜¾ç¤ºè¿›åº¦ï¼ŒæˆåŠŸåä¼šçœ‹åˆ°ï¼š
# Build complete. The dist directory is ready to be deployed.
```

**æ‰“åŒ…æˆåŠŸå**ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ `dist` æ–‡ä»¶å¤¹ï¼Œé‡Œé¢å°±æ˜¯æ‰“åŒ…å¥½çš„é™æ€æ–‡ä»¶ã€‚

### 2.3 éªŒè¯æ‰“åŒ…ç»“æœ

```bash
# æŸ¥çœ‹ dist ç›®å½•
ls -la dist/

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹æ–‡ä»¶ï¼š
# index.html
# static/
# favicon.ico
# ...
```

---

## ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ å‰ç«¯æ–‡ä»¶åˆ°æœåŠ¡å™¨ ğŸ“¤

### 3.1 å‹ç¼© dist æ–‡ä»¶å¤¹

```bash
# åœ¨å‰ç«¯ç›®å½•ä¸‹ï¼ˆåŒ…å« dist æ–‡ä»¶å¤¹çš„ç›®å½•ï¼‰
tar -czf dist.tar.gz dist/

# æŸ¥çœ‹å‹ç¼©åŒ…å¤§å°
ls -lh dist.tar.gz
```

### 3.2 ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼ å‹ç¼©åŒ…åˆ°æœåŠ¡å™¨
scp dist.tar.gz root@your-server-ip:/data/mingtai/temp/

# è¾“å…¥æœåŠ¡å™¨å¯†ç 
```

**æç¤ºï¼š** æ›¿æ¢ `your-server-ip` ä¸ºä½ çš„å®é™…æœåŠ¡å™¨IPåœ°å€ã€‚

---

## ç¬¬å››æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å‰ç«¯ ğŸ–¥ï¸

### 4.1 SSH ç™»å½•æœåŠ¡å™¨

```bash
ssh root@your-server-ip
```

### 4.2 è§£å‹å‰ç«¯æ–‡ä»¶

```bash
# è¿›å…¥ä¸´æ—¶ç›®å½•
cd /data/mingtai/temp/

# è§£å‹
tar -xzf dist.tar.gz

# æŸ¥çœ‹è§£å‹ç»“æœ
ls -la dist/
```

### 4.3 åˆ›å»ºå‰ç«¯éƒ¨ç½²ç›®å½•

```bash
# åˆ›å»º Nginx é™æ€æ–‡ä»¶ç›®å½•
sudo mkdir -p /usr/share/nginx/html/ruoyi

# ç§»åŠ¨æ–‡ä»¶åˆ° Nginx ç›®å½•
sudo mv dist/* /usr/share/nginx/html/ruoyi/

# è®¾ç½®æƒé™
sudo chmod -R 755 /usr/share/nginx/html/ruoyi

# éªŒè¯æ–‡ä»¶
ls -la /usr/share/nginx/html/ruoyi/
```

---

## ç¬¬äº”æ­¥ï¼šé…ç½® Nginx âš™ï¸

### 5.1 å¤‡ä»½åŸæœ‰é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

```bash
# å¤‡ä»½ Nginx é»˜è®¤é…ç½®
sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®
ls -la /etc/nginx/conf.d/
```

### 5.2 åˆ›å»º RuoYi é…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶
sudo vim /etc/nginx/conf.d/ruoyi.conf
```

### 5.3 å†™å…¥ä»¥ä¸‹é…ç½®

```nginx
server {
    listen       80;
    server_name  _;  # æ”¹æˆä½ çš„åŸŸåï¼Œå¦‚ï¼šyourdomain.comï¼Œæˆ–ä¿æŒ _ è¡¨ç¤ºä»»æ„åŸŸå
    
    charset utf-8;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root   /usr/share/nginx/html/ruoyi;
        try_files $uri $uri/ /index.html;
        index  index.html index.htm;
    }
    
    # åç«¯ API ä»£ç†
    location /prod-api/ {
        proxy_pass http://127.0.0.1:8080/;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header REMOTE-HOST $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 600;
        proxy_send_timeout 600;
        proxy_read_timeout 600;
        send_timeout 600;
    }
    
    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 100m;
    client_body_buffer_size 128k;
    
    # Gzip å‹ç¼©é…ç½®
    gzip on;
    gzip_min_length 1k;
    gzip_buffers 4 16k;
    gzip_http_version 1.1;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;
    gzip_vary on;
    gzip_proxied expired no-cache no-store private auth;
    gzip_disable "MSIE [1-6]\.";
    
    # é”™è¯¯é¡µé¢
    error_page 404 /index.html;
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
    
    # æ—¥å¿—é…ç½®
    access_log  /var/log/nginx/ruoyi_access.log;
    error_log   /var/log/nginx/ruoyi_error.log;
}
```

**ä¿å­˜é€€å‡ºï¼š** æŒ‰ `Esc`ï¼Œè¾“å…¥ `:wq`ï¼Œå›è½¦ã€‚

### 5.4 æµ‹è¯• Nginx é…ç½®

```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
sudo nginx -t

# åº”è¯¥çœ‹åˆ°ï¼š
# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
# nginx: configuration file /etc/nginx/nginx.conf test is successful
```

**å¦‚æœæœ‰é”™è¯¯ï¼š**
- ä»”ç»†æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„åˆ†å·ã€æ‹¬å·æ˜¯å¦å®Œæ•´
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®

### 5.5 é‡å¯ Nginx

```bash
# é‡å¯ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹ Nginx çŠ¶æ€
sudo systemctl status nginx

# åº”è¯¥çœ‹åˆ° Active: active (running)
```

### 5.6 è®¾ç½® Nginx å¼€æœºè‡ªå¯

```bash
sudo systemctl enable nginx
```

---

## ç¬¬å…­æ­¥ï¼šé…ç½®é˜²ç«å¢™ ğŸ”¥

### 6.1 å¼€æ”¾ 80 ç«¯å£

```bash
# CentOS/RHEL ä½¿ç”¨ firewalld
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --reload

# æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£
sudo firewall-cmd --list-ports
```

### 6.2 å¦‚æœä½¿ç”¨äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ï¼‰

è¿˜éœ€è¦åœ¨**äº‘æœåŠ¡å™¨æ§åˆ¶å°**çš„**å®‰å…¨ç»„**ä¸­å¼€æ”¾ 80 ç«¯å£ï¼š

1. ç™»å½•äº‘æœåŠ¡å™¨æ§åˆ¶å°
2. æ‰¾åˆ°ä½ çš„æœåŠ¡å™¨å®ä¾‹
3. ç‚¹å‡»ã€Œå®‰å…¨ç»„ã€
4. æ·»åŠ å…¥ç«™è§„åˆ™ï¼š
   - ç«¯å£ï¼š80
   - åè®®ï¼šTCP
   - æºï¼š0.0.0.0/0ï¼ˆå…è®¸æ‰€æœ‰IPè®¿é—®ï¼‰

---

## ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯éƒ¨ç½² âœ…

### 7.1 åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•

```bash
# æµ‹è¯•å‰ç«¯é™æ€æ–‡ä»¶
curl http://localhost/

# åº”è¯¥è¿”å› HTML å†…å®¹

# æµ‹è¯• API ä»£ç†
curl http://localhost/prod-api/captchaImage

# åº”è¯¥è¿”å› JSON æ•°æ®
```

### 7.2 åœ¨æµè§ˆå™¨ä¸­è®¿é—®

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
http://your-server-ip
```

**åº”è¯¥çœ‹åˆ°ï¼š**
- è‹¥ä¾ç®¡ç†ç³»ç»Ÿçš„ç™»å½•é¡µé¢
- æœ‰éªŒè¯ç å›¾ç‰‡
- å¯ä»¥è¾“å…¥ç”¨æˆ·åå¯†ç 

### 7.3 æµ‹è¯•ç™»å½•

**é»˜è®¤è´¦å·ï¼š**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

ç‚¹å‡»ç™»å½•ï¼Œå¦‚æœèƒ½æˆåŠŸè¿›å…¥ç³»ç»Ÿï¼Œè¯´æ˜å‰åç«¯éƒ½éƒ¨ç½²æˆåŠŸäº†ï¼

---

## ç¬¬å…«æ­¥ï¼šå¸¸è§é—®é¢˜æ’æŸ¥ ğŸ”

### é—®é¢˜1ï¼šè®¿é—®æ˜¾ç¤º 404 Not Found

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥å‰ç«¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /usr/share/nginx/html/ruoyi/

# 2. æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# 3. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/ruoyi_error.log

# 4. æ£€æŸ¥ Nginx æ˜¯å¦è¿è¡Œ
sudo systemctl status nginx
```

### é—®é¢˜2ï¼šé¡µé¢èƒ½æ‰“å¼€ï¼Œä½†ç™»å½•å¤±è´¥æˆ–æ¥å£æŠ¥é”™

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
sudo systemctl status ruoyi

# 2. æµ‹è¯•åç«¯æ¥å£
curl http://localhost:8080/

# 3. æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /data/mingtai/logs/ruoyi.log

# 4. æ£€æŸ¥ Nginx ä»£ç†é…ç½®
curl http://localhost/prod-api/captchaImage
```

### é—®é¢˜3ï¼šé¡µé¢ç©ºç™½æˆ–æŠ¥é”™

**æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼š**
1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. æŸ¥çœ‹ `Console` æ ‡ç­¾é¡µï¼Œçœ‹æ˜¯å¦æœ‰æŠ¥é”™
3. æŸ¥çœ‹ `Network` æ ‡ç­¾é¡µï¼Œçœ‹æ¥å£è¯·æ±‚æ˜¯å¦æˆåŠŸ

**å¸¸è§é”™è¯¯ï¼š**
- **è·¨åŸŸé”™è¯¯**ï¼šæ£€æŸ¥åç«¯çš„è·¨åŸŸé…ç½®
- **æ¥å£404**ï¼šæ£€æŸ¥ Nginx çš„ `/prod-api/` ä»£ç†é…ç½®
- **èµ„æºåŠ è½½å¤±è´¥**ï¼šæ£€æŸ¥å‰ç«¯æ–‡ä»¶è·¯å¾„å’Œæƒé™

### é—®é¢˜4ï¼šè®¿é—®å¾ˆæ…¢

```bash
# æ£€æŸ¥æœåŠ¡å™¨èµ„æºä½¿ç”¨
top
htop

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -an | grep 80
```

---

## ç¬¬ä¹æ­¥ï¼šæ€§èƒ½ä¼˜åŒ–å»ºè®® ğŸš€

### 9.1 å¯ç”¨ Nginx ç¼“å­˜

åœ¨ Nginx é…ç½®ä¸­æ·»åŠ ï¼š

```nginx
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    root /usr/share/nginx/html/ruoyi;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 9.2 ä¼˜åŒ– Gzip å‹ç¼©

å·²ç»åœ¨ä¸Šé¢çš„é…ç½®ä¸­åŒ…å«äº†ï¼Œç¡®ä¿å·²å¼€å¯ã€‚

### 9.3 CDN åŠ é€Ÿï¼ˆå¯é€‰ï¼‰

å¦‚æœç½‘ç«™è®¿é—®é‡å¤§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æºã€‚

---

## ç¬¬åæ­¥ï¼šæ—¥å¸¸è¿ç»´å‘½ä»¤ ğŸ“

### 10.1 æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/ruoyi_access.log

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/ruoyi_error.log

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /data/mingtai/logs/ruoyi.log
```

### 10.2 é‡å¯æœåŠ¡

```bash
# é‡å¯ Nginx
sudo systemctl restart nginx

# é‡å¯åç«¯
sudo systemctl restart ruoyi

# åŒæ—¶é‡å¯
sudo systemctl restart nginx ruoyi
```

### 10.3 æ›´æ–°å‰ç«¯

```bash
# 1. æœ¬åœ°é‡æ–°æ‰“åŒ…
cd ruoyi-ui2
npm run build:prod
tar -czf dist.tar.gz dist/

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp dist.tar.gz root@your-server-ip:/data/mingtai/temp/

# 3. åœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°
ssh root@your-server-ip
cd /data/mingtai/temp
tar -xzf dist.tar.gz

# 4. å¤‡ä»½æ—§ç‰ˆæœ¬
sudo mv /usr/share/nginx/html/ruoyi /usr/share/nginx/html/ruoyi.bak.$(date +%Y%m%d)

# 5. éƒ¨ç½²æ–°ç‰ˆæœ¬
sudo mkdir -p /usr/share/nginx/html/ruoyi
sudo mv dist/* /usr/share/nginx/html/ruoyi/
sudo chmod -R 755 /usr/share/nginx/html/ruoyi

# 6. æ¸…ç†æµè§ˆå™¨ç¼“å­˜åè®¿é—®
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] å‰ç«¯ä»£ç å·²æ‰“åŒ…ï¼ˆnpm run build:prodï¼‰
- [ ] dist æ–‡ä»¶å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] å‰ç«¯æ–‡ä»¶å·²éƒ¨ç½²åˆ° `/usr/share/nginx/html/ruoyi/`
- [ ] Nginx é…ç½®æ–‡ä»¶å·²åˆ›å»ºï¼ˆ`/etc/nginx/conf.d/ruoyi.conf`ï¼‰
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡ï¼ˆnginx -tï¼‰
- [ ] Nginx å·²é‡å¯å¹¶è¿è¡Œæ­£å¸¸
- [ ] é˜²ç«å¢™å·²å¼€æ”¾ 80 ç«¯å£
- [ ] æµè§ˆå™¨èƒ½è®¿é—®ç™»å½•é¡µé¢ï¼ˆhttp://your-server-ipï¼‰
- [ ] èƒ½çœ‹åˆ°éªŒè¯ç å›¾ç‰‡
- [ ] èƒ½æˆåŠŸç™»å½•ç³»ç»Ÿ
- [ ] å„ä¸ªèœå•åŠŸèƒ½æ­£å¸¸

---

## ğŸ‰ æ­å–œï¼å‰åç«¯éƒ½éƒ¨ç½²æˆåŠŸäº†ï¼

ç°åœ¨ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ç³»ç»Ÿï¼š

```
http://your-server-ip
```

**åç»­å»ºè®®ï¼š**
1. ç»‘å®šåŸŸåï¼ˆå¯é€‰ï¼‰
2. é…ç½® HTTPSï¼ˆæ¨èï¼‰
3. å®šæœŸå¤‡ä»½æ•°æ®åº“
4. ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œéšæ—¶æŸ¥çœ‹æ—¥å¿—è¿›è¡Œæ’æŸ¥ï¼

























# ğŸ“‚ åŸºäºç°æœ‰ç›®å½•ç»“æ„çš„å®Œæ•´éƒ¨ç½²æµç¨‹

## å½“å‰ç›®å½•ç»“æ„ç¡®è®¤

```
/opt/docker/nginx/
â”œâ”€â”€ conf/     # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ data/     # æ•°æ®ç›®å½•
â”œâ”€â”€ html/     # å‰ç«¯é™æ€æ–‡ä»¶ï¼ˆè¿™æ˜¯æˆ‘ä»¬è¦éƒ¨ç½²çš„åœ°æ–¹ï¼‰
â””â”€â”€ logs/     # æ—¥å¿—æ–‡ä»¶
```

---

## ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥å¹¶éƒ¨ç½²å‰ç«¯æ–‡ä»¶ ğŸ“

### 1.1 æŸ¥çœ‹ html ç›®å½•å½“å‰å†…å®¹

```bash
# æŸ¥çœ‹å‰ç«¯ç›®å½•
ls -la /opt/docker/nginx/html/
```

### 1.2 æ¸…ç©ºå¹¶å‡†å¤‡ç›®å½•

```bash
# å¤‡ä»½æ—§æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰
if [ -d "/opt/docker/nginx/html" ] && [ "$(ls -A /opt/docker/nginx/html)" ]; then
    mv /opt/docker/nginx/html /opt/docker/nginx/html.bak.$(date +%Y%m%d)
fi

# åˆ›å»ºhtmlç›®å½•
mkdir -p /opt/docker/nginx/html

# è®¾ç½®æƒé™
chmod 755 /opt/docker/nginx/html
```

### 1.3 å°†å‰ç«¯æ–‡ä»¶éƒ¨ç½²åˆ° html ç›®å½•

```bash
# å‡è®¾ä½ çš„ dist.tar.gz åœ¨ /data/mingtai/temp/
cd /data/mingtai/temp/

# è§£å‹
tar -xzf dist.tar.gz

# æŸ¥çœ‹è§£å‹å†…å®¹
ls -la dist/

# å¤åˆ¶åˆ° nginx html ç›®å½•
cp -r dist/* /opt/docker/nginx/html/

# è®¾ç½®æƒé™
chmod -R 755 /opt/docker/nginx/html/

# éªŒè¯æ–‡ä»¶
ls -la /opt/docker/nginx/html/
```

**åº”è¯¥çœ‹åˆ°ï¼š**
```
total 12
-rw-r--r-- 1 root root  1234 Oct 28 13:00 index.html
drwxr-xr-x 3 root root  4096 Oct 28 13:00 static
-rw-r--r-- 1 root root  4286 Oct 28 13:00 favicon.ico
...
```

---

## ç¬¬äºŒæ­¥ï¼šéªŒè¯ Docker Compose æŒ‚è½½é…ç½® ğŸ”

### 2.1 æŸ¥çœ‹ docker-compose.yml

```bash
# æ‰¾åˆ°å¹¶æŸ¥çœ‹é…ç½®æ–‡ä»¶
cat /opt/docker/docker-compose.yml | grep -A 20 nginx
```

**ç¡®è®¤ volumes é…ç½®ï¼š**
```yaml
nginx:
  volumes:
    - /opt/docker/nginx/conf/nginx.conf:/etc/nginx/nginx.conf
    - /opt/docker/nginx/html:/usr/share/nginx/html
    - /opt/docker/nginx/logs:/var/log/nginx
```

å¦‚æœä½ çš„é…ç½®ä¸åŒï¼Œè®°ä¸‹å®é™…çš„æŒ‚è½½è·¯å¾„ã€‚

---

## ç¬¬ä¸‰æ­¥ï¼šå®Œå–„ Nginx é…ç½® ğŸ“

### 3.1 æ£€æŸ¥å½“å‰é…ç½®

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
cat /opt/docker/nginx/conf/nginx.conf
```

### 3.2 ç¡®ä¿é…ç½®åŒ…å«ä»¥ä¸‹å†…å®¹

å¦‚æœä¹‹å‰å·²ç»ä¿®æ”¹è¿‡ï¼Œç¡®è®¤åŒ…å«è¿™äº›å…³é”®é…ç½®ï¼š

```bash
# ç¼–è¾‘é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
vim /opt/docker/nginx/conf/nginx.conf
```

**å…³é”®é…ç½®ç‚¹ï¼š**

1. **å‰ç«¯é™æ€æ–‡ä»¶è·¯å¾„ï¼š**
```nginx
location / {
    root   /usr/share/nginx/html;  # å®¹å™¨å†…è·¯å¾„
    try_files $uri $uri/ /index.html;
    index  index.html index.htm;
}
```

2. **åç«¯APIä»£ç†ï¼š**
```nginx
location /prod-api/ {
    proxy_pass http://172.17.0.1:8080/;  # æ›¿æ¢ä¸ºå®é™…çš„å®¿ä¸»æœºIP
    # ... å…¶ä»–é…ç½®
}
```

### 3.3 è·å–å®¿ä¸»æœº IP å¹¶æ›´æ–°é…ç½®

```bash
# æŸ¥çœ‹å®¿ä¸»æœºdocker0ç½‘å¡IP
ip addr show docker0 | grep "inet "

# ä¼šçœ‹åˆ°ç±»ä¼¼ï¼šinet 172.17.0.1/16
```

**ä¿®æ”¹ proxy_passï¼š**
```bash
vim /opt/docker/nginx/conf/nginx.conf

# æ‰¾åˆ° proxy_pass è¿™è¡Œï¼Œæ”¹ä¸ºï¼š
# proxy_pass http://172.17.0.1:8080/;  # ä½¿ç”¨ä½ å®é™…çœ‹åˆ°çš„IP
```

ä¿å­˜é€€å‡ºï¼ˆ`:wq`ï¼‰

---

## ç¬¬å››æ­¥ï¼šé‡å¯ Nginx å®¹å™¨ ğŸš€

### 4.1 è¿›å…¥ docker-compose ç›®å½•

```bash
cd /opt/docker
```

### 4.2 æŸ¥çœ‹å½“å‰å®¹å™¨çŠ¶æ€

```bash
docker-compose ps

# æˆ–
docker ps -a | grep nginx
```

### 4.3 é‡å¯ Nginx

```bash
# æ–¹æ³•1ï¼šé‡å¯å®¹å™¨
docker-compose restart nginx

# æ–¹æ³•2ï¼šå¦‚æœéœ€è¦é‡æ–°åˆ›å»ºå®¹å™¨
docker-compose up -d --force-recreate nginx

# æ–¹æ³•3ï¼šåœæ­¢åå¯åŠ¨
docker-compose stop nginx
docker-compose start nginx
```

### 4.4 æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f nginx

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# nginx_1  | Configuration complete; ready for start up
```

æŒ‰ `Ctrl + C` åœæ­¢æŸ¥çœ‹ï¼ˆå®¹å™¨ç»§ç»­è¿è¡Œï¼‰

---

## ç¬¬äº”æ­¥ï¼šéªŒè¯å®¹å™¨å†…æ–‡ä»¶ âœ…

### 5.1 è¿›å…¥å®¹å™¨æ£€æŸ¥

```bash
# è¿›å…¥ nginx å®¹å™¨
docker exec -it nginx bash
```

### 5.2 åœ¨å®¹å™¨å†…æ£€æŸ¥æ–‡ä»¶

```bash
# æŸ¥çœ‹å‰ç«¯æ–‡ä»¶
ls -la /usr/share/nginx/html/

# åº”è¯¥çœ‹åˆ° index.html, static/ ç­‰

# æŸ¥çœ‹é…ç½®æ–‡ä»¶
cat /etc/nginx/nginx.conf | grep -A 5 "location /"

# æµ‹è¯•é…ç½®
nginx -t

# æµ‹è¯•åç«¯è¿æ¥
curl http://172.17.0.1:8080/

# é€€å‡ºå®¹å™¨
exit
```

---

## ç¬¬å…­æ­¥ï¼šæœåŠ¡å™¨æœ¬åœ°æµ‹è¯• ğŸ§ª

### 6.1 æµ‹è¯•å‰ç«¯é™æ€æ–‡ä»¶

```bash
# æµ‹è¯•é¦–é¡µ
curl http://localhost/

# åº”è¯¥è¿”å› HTML å†…å®¹ï¼ŒåŒ…å« <!DOCTYPE html>
```

### 6.2 æµ‹è¯• API ä»£ç†

```bash
# æµ‹è¯•éªŒè¯ç æ¥å£
curl http://localhost/prod-api/captchaImage

# åº”è¯¥è¿”å› JSON æ ¼å¼æ•°æ®ï¼Œç±»ä¼¼ï¼š
# {"msg":"æ“ä½œæˆåŠŸ","img":"...","code":200,"captchaEnabled":true,"uuid":"..."}
```

### 6.3 æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
# æ£€æŸ¥80ç«¯å£
netstat -tulnp | grep :80

# æˆ–
ss -tulnp | grep :80

# åº”è¯¥çœ‹åˆ° docker-proxy ç›‘å¬ 80 ç«¯å£
```

---

## ç¬¬ä¸ƒæ­¥ï¼šæŸ¥çœ‹æ—¥å¿— ğŸ“‹

### 7.1 æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—

```bash
# æ–¹æ³•1ï¼šç›´æ¥æŸ¥çœ‹å®¿ä¸»æœºæ—¥å¿—æ–‡ä»¶
tail -f /opt/docker/nginx/logs/access.log

# æ–¹æ³•2ï¼šé€šè¿‡ docker æŸ¥çœ‹
docker exec nginx tail -f /var/log/nginx/access.log

# æ–¹æ³•3ï¼šæŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f nginx
```

### 7.2 æŸ¥çœ‹é”™è¯¯æ—¥å¿—

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /opt/docker/nginx/logs/error.log

# æˆ–
docker exec nginx tail -f /var/log/nginx/error.log
```

---

## ç¬¬å…«æ­¥ï¼šæµè§ˆå™¨è®¿é—®æµ‹è¯• ğŸŒ

### 8.1 æ‰“å¼€æµè§ˆå™¨è®¿é—®

```
http://your-server-ip
```

### 8.2 é¢„æœŸç»“æœ

**åº”è¯¥çœ‹åˆ°ï¼š**
- âœ… è‹¥ä¾ç®¡ç†ç³»ç»Ÿç™»å½•é¡µé¢
- âœ… é¡µé¢æ ·å¼æ­£å¸¸
- âœ… éªŒè¯ç å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸
- âœ… è¾“å…¥æ¡†æ­£å¸¸

### 8.3 æµ‹è¯•ç™»å½•

**é»˜è®¤è´¦å·ï¼š**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`

è¾“å…¥åç‚¹å‡»ç™»å½•ã€‚

### 8.4 å¦‚æœå‡ºç°é—®é¢˜

æŒ‰ `F12` æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼š

1. **Console æ ‡ç­¾**ï¼šæŸ¥çœ‹JSé”™è¯¯
2. **Network æ ‡ç­¾**ï¼šæŸ¥çœ‹ç½‘ç»œè¯·æ±‚
   - ç‚¹å‡» `prod-api` å¼€å¤´çš„è¯·æ±‚
   - æŸ¥çœ‹çŠ¶æ€ç ï¼ˆåº”è¯¥æ˜¯ 200ï¼‰
   - å¦‚æœæ˜¯ 502/504ï¼šåç«¯è¿æ¥é—®é¢˜
   - å¦‚æœæ˜¯ 404ï¼šè·¯å¾„é…ç½®é—®é¢˜

---

## ç¬¬ä¹æ­¥ï¼šå¸¸è§é—®é¢˜å¿«é€Ÿæ’æŸ¥ ğŸ”§

### é—®é¢˜1ï¼šé¡µé¢æ˜¾ç¤º 404

```bash
# 1. æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /opt/docker/nginx/html/index.html

# 2. è¿›å®¹å™¨æ£€æŸ¥
docker exec nginx ls -la /usr/share/nginx/html/

# 3. å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‡æ–°éƒ¨ç½²
cp -r /data/mingtai/temp/dist/* /opt/docker/nginx/html/
docker-compose restart nginx
```

### é—®é¢˜2ï¼šé¡µé¢æ˜¾ç¤º 502 Bad Gateway

```bash
# 1. ç¡®è®¤åç«¯è¿è¡Œ
systemctl status ruoyi
curl http://localhost:8080/

# 2. æµ‹è¯•å®¹å™¨åˆ°åç«¯è¿æ¥
docker exec nginx curl http://172.17.0.1:8080/

# 3. å¦‚æœå¤±è´¥ï¼Œæ›´æ–° nginx.conf ä¸­çš„ proxy_pass
vim /opt/docker/nginx/conf/nginx.conf
# æ”¹ä¸ºæ­£ç¡®çš„IPåé‡å¯
docker-compose restart nginx
```

### é—®é¢˜3ï¼šç™»å½•åæ¥å£æŠ¥é”™

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /data/mingtai/logs/ruoyi.log

# æŸ¥çœ‹nginxä»£ç†æ—¥å¿—
tail -f /opt/docker/nginx/logs/access.log
```

### é—®é¢˜4ï¼šé™æ€èµ„æºåŠ è½½å¤±è´¥

```bash
# æ£€æŸ¥é™æ€æ–‡ä»¶
ls -la /opt/docker/nginx/html/static/

# æ£€æŸ¥æƒé™
chmod -R 755 /opt/docker/nginx/html/

# é‡å¯nginx
docker-compose restart nginx
```

---

## ç¬¬åæ­¥ï¼šæ—¥å¸¸ç»´æŠ¤å‘½ä»¤ ğŸ“

### 10.1 æ›´æ–°å‰ç«¯

```bash
# 1. ä¸Šä¼ æ–°çš„ dist.tar.gz

# 2. å¤‡ä»½æ—§ç‰ˆæœ¬
mv /opt/docker/nginx/html /opt/docker/nginx/html.bak.$(date +%Y%m%d)

# 3. éƒ¨ç½²æ–°ç‰ˆæœ¬
cd /data/mingtai/temp
tar -xzf dist.tar.gz
mkdir -p /opt/docker/nginx/html
cp -r dist/* /opt/docker/nginx/html/
chmod -R 755 /opt/docker/nginx/html/

# 4. ä¸éœ€è¦é‡å¯ï¼Œåˆ·æ–°æµè§ˆå™¨å³å¯
# æˆ–è€…é‡æ–°åŠ è½½nginxé…ç½®
docker exec nginx nginx -s reload
```

### 10.2 æŸ¥çœ‹å’Œç®¡ç†æœåŠ¡

```bash
# è¿›å…¥dockerç›®å½•
cd /opt/docker

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# é‡å¯nginx
docker-compose restart nginx

# æŸ¥çœ‹nginxæ—¥å¿—
docker-compose logs -f nginx

# è¿›å…¥nginxå®¹å™¨
docker exec -it nginx bash
```

### 10.3 å¤‡ä»½é‡è¦æ–‡ä»¶

```bash
# å¤‡ä»½nginxé…ç½®
cp /opt/docker/nginx/conf/nginx.conf /opt/docker/nginx/conf/nginx.conf.bak

# å¤‡ä»½å‰ç«¯æ–‡ä»¶
tar -czf /opt/docker/nginx/html-backup-$(date +%Y%m%d).tar.gz /opt/docker/nginx/html/
```

---

## âœ… æœ€ç»ˆæ£€æŸ¥æ¸…å•

- [ ] å‰ç«¯æ–‡ä»¶å·²éƒ¨ç½²åˆ° `/opt/docker/nginx/html/`
- [ ] `index.html` æ–‡ä»¶å­˜åœ¨
- [ ] `static/` ç›®å½•å­˜åœ¨
- [ ] nginx.conf é…ç½®æ­£ç¡®
- [ ] proxy_pass ä½¿ç”¨æ­£ç¡®çš„å®¿ä¸»æœºIP
- [ ] nginx å®¹å™¨å·²é‡å¯
- [ ] å®¹å™¨å†…èƒ½çœ‹åˆ°å‰ç«¯æ–‡ä»¶
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡ï¼ˆ`curl http://localhost/`ï¼‰
- [ ] æµè§ˆå™¨èƒ½è®¿é—®ç™»å½•é¡µé¢
- [ ] éªŒè¯ç æ˜¾ç¤ºæ­£å¸¸
- [ ] èƒ½æˆåŠŸç™»å½•ç³»ç»Ÿ

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼š`http://your-server-ip`

å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ’æŸ¥æ­¥éª¤é€æ­¥æ£€æŸ¥ï¼Œæˆ–è€…å‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼