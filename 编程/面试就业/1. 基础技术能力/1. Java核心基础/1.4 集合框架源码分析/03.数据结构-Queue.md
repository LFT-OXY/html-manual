# 数据结构Queue

## 一、Queue是接口

> 因为Queue是一个接口，所以是不知道它的具体实现方案的。
>
> 1. 一种是数组的Queue
> 2. 一种的链表的Queue

![image-20250417111158060](https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/mayuhang/202504171111147.png)

特点：

1. 一单看见某个实现类有offer，poll关键函数，就表示拥有Queue的特点。
2. 如果一个实现类，有offer，poll，push，pop，表明是拥有stack和Queue两方特点，那就是Deque，双端队列。

![image-20250417111906327](https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/mayuhang/202504171119411.png)

## 二、并发相关前置知识

### 1. 阻塞队列

在Java中，"阻塞"（Blocking）通常指的是**程序在执行过程中**，由于某些资源不可用或某些条件未满足，导致当前执行的线程**被挂起(CPU不会去调度执行这线程)**，无法继续执行后续的操作，直到所需的资源变得可用或条件得到满足。

阻塞可以发生在多种情况下，以下是一些常见的阻塞场景：

1. **I/O阻塞**：
   - 当线程进行输入输出操作（如读写文件、网络通信等）时，如果数据尚未准备好或网络连接未建立，线程会被阻塞，直到I/O操作完成。

2. **同步阻塞**：
   - 在多线程环境中，使用同步机制（如`synchronized`关键字或`ReentrantLock`）来控制对共享资源的访问时，如果线程试图获取一个已经被其他线程持有的锁，它会被阻塞，直到锁被释放。

3. **等待阻塞**：
   - 使用`wait()`、`notify()`、`notifyAll()`方法进行线程间通信时，调用`wait()`方法的线程会释放持有的锁并进入等待状态，直到其他线程调用`notify()`或`notifyAll()`方法唤醒它。

4. **线程池阻塞**：
   - 在使用线程池时，如果所有线程都在执行任务，新提交的任务可能会被阻塞，直到有线程空闲出来。

5. **网络阻塞**：
   - 在进行网络编程时，如果网络连接未建立或数据传输未完成，相关线程可能会被阻塞。

阻塞是并发编程中的一个重要概念，合理处理阻塞可以提高程序的效率和响应性。为了避免长时间的阻塞，通常需要采用异步编程、非阻塞I/O、锁优化等技术手段。

以下是一个简单的示例，展示了线程在同步阻塞中的情况：

```java
public class BlockingExample {
    private final Object lock = new Object();

    public void doSomething() {
        synchronized (lock) {
            // 执行一些操作
            System.out.println("线程 " + Thread.currentThread().getName() + " 获得了锁");
            try {
                // 模拟耗时操作 第一个线程，进入这个方法，第二个线程在外面就是阻塞状态
                // 怎么实现的阻塞，后面带着看JDK中的C语言ObjectMonitor.c 里面有讲
                Thread.sleep(2000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    public static void main(String[] args) {
        BlockingExample example = new BlockingExample();
        Thread thread1 = new Thread(example::doSomething, "Thread-1");
        Thread thread2 = new Thread(example::doSomething, "Thread-2");

        thread1.start();
        thread2.start();
    }
}
```

在这个示例中，`doSomething`方法使用了`synchronized`关键字来同步访问`lock`对象。当`thread1`正在执行`doSomething`方法时，`thread2`尝试进入该方法会被阻塞，直到`thread1`释放锁。



阻塞继承关系图。



![image-20250417112034409](https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/mayuhang/202504171120470.png)



java.util.concurrent这个包下面，就是阻塞队列。

这个东西就是JUC, 它的常见实现类：



**ArrayBlockingQueue** ：一个由数组结构组成的有界阻塞队列。               

**LinkedBlockingQueue** ：一个由链表结构组成的有界阻塞队列。               

**PriorityBlockingQueue** ：一个支持优先级排序的无界阻塞队列。               

**DelayQueue**：一个使用优先级队列实现的无界阻塞队列。               

**SynchronousQueue**：一个不存储元素的阻塞队列。               
**LinkedTransferQueue**：一个由链表结构组成的无界阻塞队列。               
**LinkedBlockingDeque**：一个由链表结构组成的双向阻塞队列           
定义：满了放不进，空了拿不出！下图为BlockingQueue的方法!           
![img](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/mayuhang/20210713095207.png)

![image-20241213154047685](https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/mayuhang/202412131540874.png)

![image-20210712120127609](https://woniumd.oss-cn-hangzhou.aliyuncs.com/java/mayuhang/20210712120127.png)

http://ifeve.com/java-blocking-queue/  具体的百度资料，这个比较详尽，参考jdk1.8api辅助阅读！            

非阻塞队列： **ConcurrentLinkedQueue 性能比较好，它是一个类**



## 三、自己去写一个Queue

基于数组实现的Queue。

```java
package com.woniuxy.queue;

/**
 * @Author: 马宇航
 * @Todo: 我自定义的数组队列
 * @DateTime: 25/04/17/星期四 11:28
 * @Component: 成都蜗牛学苑
 **/
public class MyArrayQueue {
    private Object[] arr;
    private int head; //队列头 头出数据
    private int tail; //队列尾 尾进数据
    private int size;
    //构造方法

    public MyArrayQueue() {
        arr = new Object[10];
    }

    //入队 offer
    public void offer(Object value){
        if (size == arr.length){
            System.out.println("队列已满");
            return;
        }
        arr[tail++] = value;
        size++;
    }
    //出队 poll
    public Object poll(){
        if (size == 0){
            System.out.println("队列为空");
            return null;
        }
        Object value = arr[head];
        arr[head++] = null;
        size--;
        return value;
    }
    //查看 peek
    //队列是否为空 isEmpty
    //队列是否已满 isFull
}
```

## 四、扩展就业需要了解的知识

1. 阻塞概念
2. 任务调度
3. MQ消息队列：RabbitMQ，RocketMQ, kafka，zookeeper
4. 线程池
5. redis里面有没有？List，rpush，lpush，rpop，lpop，同时提供**阻塞效果**（停车场）！
6. JUC里面的这个 CyclicBarrier类？Semaphore？，就停车场阻塞效果。

